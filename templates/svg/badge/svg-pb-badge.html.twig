{% set rectangleWidth = 80 %}
{% set rectangleHeight = 60 %}
{% set gapBetweenRectangles = 12.5 %}
{% set totalItems = sportType.getActivityType().getDistancesForBestEffortCalculation()|length %}
{% set itemsPerRow = totalItems == 12 ? 4 : 5 %}
{% set totalRows = (totalItems / itemsPerRow)|round(0, 'ceil') %}
{% set svgWidth = (itemsPerRow * (rectangleWidth + gapBetweenRectangles)) + 30 - gapBetweenRectangles  %}
{% set svgHeight = totalRows * (rectangleHeight + gapBetweenRectangles) + 80 %}
<svg xmlns="http://www.w3.org/2000/svg" width="{{ svgWidth }}" height="{{ svgHeight }}" viewBox="0 0 {{ svgWidth }} {{ svgHeight }}" fill="none" role="img">
    <rect x="0.5" y="0.5" rx="4.5" height="99%" stroke="#e4e2e2" width="{{ svgWidth - 1 }}" fill="#fffefe" stroke-opacity="1"/>
    <g transform="translate(15, 35)">
        <g transform="translate(0, 0)">
            <g transform="translate(0, -18)">
                <svg width="25px" height="25px" viewBox="0 0 160.43555 160.7915">
                    <defs id="defs1"/>
                    <circle fill="#ffffff" stroke="0" cx="80.377411" cy="80.550003" r="80"/>
                    <path fill="#fc5200" stroke="0"
                          d="M 80.277832,0 A 80.5,80.5 0 0 0 1.8251954,63.399902 c 2.1321507,-1.480969 4.7071544,-2.364257 7.4956054,-2.364257 7.2929702,0 13.2304682,5.933588 13.2304682,13.230468 0,1.83984 -0.382806,3.593262 -1.066406,5.187012 l 19.965821,16.949707 c 2.41406,-3.21094 6.245608,-5.301269 10.565918,-5.301269 3.94922,0 7.492677,1.750484 9.918457,4.504394 L 87.880371,57.859863 c -2.46093,-2.40235 -3.993164,-5.750971 -3.993164,-9.454101 0,-7.29297 5.934569,-13.230469 13.227539,-13.230469 7.296864,0 13.230464,5.937499 13.230464,13.230469 0,0.85938 -0.0869,1.696283 -0.24316,2.504883 l 30.68408,23.690918 c 2.42188,-3.125001 6.19873,-5.148926 10.44873,-5.148926 3.58169,0 6.81827,1.44643 9.20068,3.767578 A 80.5,80.5 0 0 0 80.277832,0 Z m 16.836914,40.589355 c -4.3086,0 -7.813477,3.507817 -7.813477,7.816407 0,4.3125 3.504877,7.816406 7.813477,7.816406 4.312494,0 7.819334,-3.503906 7.819334,-7.816406 0,-4.30859 -3.50684,-7.816407 -7.819334,-7.816407 z m 10.781244,15.457032 c -2.39844,3.375 -6.33203,5.589843 -10.781244,5.589843 -1.64453,0 -3.215337,-0.316407 -4.668457,-0.867187 L 64.801758,100.99219 c 0.27734,1.07031 0.440918,2.18359 0.440918,3.33984 0,7.29297 -5.933104,13.22608 -13.226074,13.22608 -7.292971,0 -13.230469,-5.93311 -13.230469,-13.22608 0,-0.96875 0.112791,-1.91406 0.312011,-2.82422 L 18.355957,83.898926 c -2.36719,2.22266 -5.539066,3.593262 -9.0351562,3.593262 -3.6442917,0 -6.9275833,-1.499078 -9.320800787014476,-3.89209 A 80.5,80.5 0 0 0 17.427246,130.52637 V 88.769531 c 0.28906,-0.15234 5.737793,4.929199 5.737793,4.929199 v 43.24219 a 80.5,80.5 0 0 0 24.222656,16.98926 v -33.01172 c 1.47656,0.72266 3.027347,1.14843 4.628907,1.14843 0.39453,0 0.785155,-0.0322 1.171875,-0.0791 v 34.10596 a 80.5,80.5 0 0 0 24.1875,4.69775 V 91.914551 l 5.805175,-8.833008 V 160.7915 A 80.5,80.5 0 0 0 107.0083,156.22852 V 61.835449 c 0.51953,-0.35156 6.52002,4.019531 6.52002,4.019531 v 87.94043 a 80.5,80.5 0 0 0 23.83154,-16.82373 V 93.703125 c 1.57031,1.96875 3.54297,3.593268 5.80078,4.753418 v 32.027347 a 80.5,80.5 0 0 0 16.63184,-37.759281 c -2.30856,1.97493 -5.28749,3.186036 -8.55762,3.186036 -7.29297,0 -13.22607,-5.93458 -13.22607,-13.22754 0,-1.07032 0.14013,-2.104974 0.38232,-3.101074 z M 9.3208008,66.445313 c -4.30859,0 -7.8164062,3.5083 -7.8164062,7.8208 0,4.30859 3.5078162,7.812012 7.8164062,7.812012 4.3085902,0 7.8164062,-3.503422 7.8164062,-7.812012 0,-4.3125 -3.507816,-7.8208 -7.8164062,-7.8208 z M 151.23486,74.86377 c -4.30859,0 -7.81641,3.506835 -7.81641,7.819335 0,4.30859 3.50782,7.816407 7.81641,7.816407 4.3125,0 7.81641,-3.507817 7.81641,-7.816407 0,-4.3125 -3.50391,-7.819335 -7.81641,-7.819335 z M 52.016602,96.515625 c -4.3125,0 -7.816407,3.503905 -7.816407,7.816405 0,4.3086 3.503907,7.81641 7.816407,7.81641 4.308599,0 7.816406,-3.50781 7.816406,-7.81641 0,-4.3125 -3.507807,-7.816405 -7.816406,-7.816405 z"/>
                </svg>
            </g>
            <g transform="translate(35, 0)" font-family="'Segoe UI', Ubuntu, Sans-Serif" font-size="15.5px" font-weight="600">
                {% set translatedSportType = sportType|trans|lower %}
                <text x="0" y="0" fill="#111111">{{ "Best efforts for {sportType}"|trans({'{sportType}': translatedSportType}) }}</text>
            </g>
        </g>
        <g transform="translate(0, 25)" fill="#434d58" font-family="'Segoe UI', Ubuntu, 'Helvetica Neue', Sans-Serif"
           font-size="12px" font-weight="normal">
            {% set lastRowIndex = (totalItems / itemsPerRow)|round(0, 'ceil') - 1 %}
            {% for distance in sportType.getActivityType().getDistancesForBestEffortCalculation() %}
                {% set bestEffort = bestEfforts.getBySportTypeAndDistance(sportType, distance) %}
                {% set currentRow = loop.index0 // itemsPerRow %}
                {% set numberOfItemsOnThisRow = currentRow == lastRowIndex
                    ? (totalItems % itemsPerRow == 0
                    ? itemsPerRow
                    : totalItems % itemsPerRow)
                    : itemsPerRow
                %}
                {% if currentRow == lastRowIndex and numberOfItemsOnThisRow != itemsPerRow %}
                    {% set translateX = ((itemsPerRow - numberOfItemsOnThisRow) / 2) * (rectangleWidth + gapBetweenRectangles) + ((loop.index0 % itemsPerRow) * (rectangleWidth + gapBetweenRectangles)) %}
                {% else %}
                    {% set translateX = (loop.index0 % itemsPerRow) * (rectangleWidth + gapBetweenRectangles) %}
                {% endif %}
                {% set translateY = (currentRow * (rectangleHeight + gapBetweenRectangles)) %}
                <g transform="translate({{ translateX }}, {{ translateY }})">
                    {% set textX = (rectangleWidth / 2) %}
                    {% set textY = (rectangleHeight / 2) %}
                    <rect width="{{ rectangleWidth }}px" height="{{ rectangleHeight }}px" x="0" y="0" rx="10" ry="10" fill="#F4F7F9"/>
                    <text x="{{ textX }}" y="{{ textY }}" text-anchor="middle">
                        <tspan x="{{ textX }}" font-size="15.5px" font-weight="600">{{ bestEffort ? bestEffort.getFormattedTimeInSeconds() : 'n/a' }}</tspan>
                        <tspan x="{{ textX }}" dy="1.2em">{{ distance.isLowerThanOne() ? distance.toFloat()|round(1) : distance.toInt() }} {{ distance.getSymbol() }}</tspan>
                    </text>
                </g>
            {% endfor %}
        </g>
        <g transform="translate(0, {{ svgHeight - 50 }})" font-family="'Segoe UI', Ubuntu, 'Helvetica Neue', Sans-Serif" font-size="10px"
           font-weight="normal">
            <text text-anchor="middle" x="{{ (svgWidth - 30) / 2 }}" y="0" fill="#bbbbbb">generated by https://github.com/robiningelbrecht/statistics-for-strava
            </text>
        </g>
    </g>
</svg>

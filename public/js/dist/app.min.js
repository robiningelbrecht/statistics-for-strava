(()=>{"use strict";const t=(t,e)=>{const a=e.split("."),r=(t,e)=>{if(!t||0===e.length)return;const a=e[0],s=e.slice(1),o=a.endsWith("[]"),i=o?a.slice(0,-2):a;if(o){const e=t?.[i];Array.isArray(e)&&e.forEach(t=>r(t,s))}else 0===s.length?t?.[i]&&t[i]in window.statisticsForStrava.callbacks&&(t[i]=window.statisticsForStrava.callbacks[t[i]]):r(t?.[i],s)};r(t,a)};class e{constructor(t,e){this.wrapper=t,this.storage=e,this.filters={}}prefillFromStorage(t){const e=this.storage.get(t);if(!e)return;Object.keys(e).forEach(t=>{if(t.includes("."))return;const a=e[t];this.wrapper.querySelectorAll(`input[data-dataTable-filter="${t}"]`).forEach(t=>{t.value.toLowerCase()===a.toLowerCase()&&(t.checked=!0)})});const a={};Object.keys(e).filter(t=>t.includes(".")).forEach(t=>{const[r,s]=t.split(".");a[r]||(a[r]={}),a[r][s]=e[t]}),Object.keys(a).forEach(t=>{const e=a[t],r=this.wrapper.querySelector(`input[name="${t}[from]"]`),s=this.wrapper.querySelector(`input[name="${t}[to]"]`);r&&e.from&&(r.value=e.from),s&&e.to&&(s.value=e.to)}),this.storage.clearAll()}getActiveFilters(){const t={};return this.wrapper.querySelectorAll("[data-dataTable-filter]:checked").forEach(e=>{const a=e.getAttribute("data-dataTable-filter");t[a]=e.value.toLowerCase()}),this.wrapper.querySelectorAll('[data-dataTable-filter*="[]"]').forEach(e=>{const a=e.getAttribute("data-dataTable-filter").replace("[]",""),r=e.querySelector(`input[name="${a}[from]"]`),s=e.querySelector(`input[name="${a}[to]"]`);if(r&&s&&r.valueAsDate&&s.valueAsDate){const e=new Date(r.valueAsNumber).setUTCHours(0,0,0),o=new Date(s.valueAsNumber).setUTCHours(23,59,59);t[a]=[e,o]}}),t}updateDropdownState(t){this.wrapper.querySelectorAll(".filter-dropdown [data-dropdown-toggle]").forEach(t=>{t.classList.remove("active")}),Object.keys(t).forEach(e=>{const a=t[e];if(Array.isArray(a)){const t=this.wrapper.querySelector(`[data-datatable-filter="${e}[]"]`)?.closest(".filter-dropdown")?.querySelector("[data-dropdown-toggle]");return void(t&&t.classList.add("active"))}const r=this.wrapper.querySelector(`[data-dataTable-filter="${e}"]:checked`),s=r?.closest(".filter-dropdown")?.querySelector("[data-dropdown-toggle]");s&&s.classList.add("active")})}applyFiltersToRows(t,e=""){const a=this.getActiveFilters(),r=e.toLowerCase();return t.forEach(t=>{t.active=!t.searchables||t.searchables.toLowerCase().includes(r);for(const[e,r]of Object.entries(a))if(Array.isArray(r)){const a=t.filterables[e];t.active=t.active&&a>=r[0]&&a<=r[1]}else{const a=t.filterables[e]?.toLowerCase();t.active=t.active&&a===r}}),t}}class a{static calculate(t){return t.filter(t=>t.active).reduce((t,e)=>(Object.entries(e.summables).forEach(([e,a])=>t[e]=(t[e]||0)+a),t),{})}static render(t,e){const a=this.calculate(e);t.querySelectorAll("[data-dataTable-summable]").forEach(t=>{const e=t.getAttribute("data-dataTable-summable");t.innerHTML=void 0!==a[e]?(t=>{t=(t+"").replace(/[^0-9+\-Ee.]/g,"");const e=isFinite(+t)?+t:0,a=isFinite(0)?Math.abs(0):0;let r="";return r=(a?function(t,e){if(-1===(""+t).indexOf("e"))return+(Math.round(t+"e+"+e)+"e-"+e);{const a=(""+t).split("e");let r="";return+a[1]+e>0&&(r="+"),(+(Math.round(+a[0]+"e"+r+(+a[1]+e))+"e-"+e)).toFixed(e)}}(e,a).toString():""+Math.round(e)).split("."),r[0].length>3&&(r[0]=r[0].replace(/\B(?=(?:\d{3})+(?!\d))/g," ")),(r[1]||"").length<a&&(r[1]=r[1]||"",r[1]+=new Array(a-r[1].length+1).join("0")),r.join(",")})(a[e]):0})}}class r{constructor(t){this.columns=t,this.sortAsc=!1,this.sortOnPrevious=null}attachListeners(t,e,a){this.columns.forEach(r=>r.addEventListener("click",()=>{const s=r.getAttribute("data-dataTable-sort");s===this.sortOnPrevious?this.sortAsc=!this.sortAsc:this.sortAsc=!0,this.sortOnPrevious=s,this.columns.forEach(t=>t.querySelector(".sorting-icon")?.setAttribute("aria-sort","none")),r.querySelector(".sorting-icon")?.setAttribute("aria-sort",this.sortAsc?"ascending":"descending"),t.sort((t,e)=>{const a=t.sort[s],r=e.sort[s];return void 0===a?1:void 0===r?-1:a<r?this.sortAsc?-1:1:a>r?this.sortAsc?1:-1:0}),e.update(t.filter(t=>t.active).map(t=>t.markup)),a.scrollTop=0}))}}class s{constructor(t,e,a){this.wrapper=t,this.tbody=e,this.scrollElem=a,this.cluster=null}init(t){this.cluster=new Clusterize({rows:t.filter(t=>t.active).map(t=>t.markup),scrollElem:this.scrollElem,contentElem:this.tbody,no_data_class:"clusterize-loading",callbacks:{clusterChanged:()=>{a.render(this.wrapper,t);const e=this.wrapper.querySelector("[data-dataTable-result-count]");e&&(e.innerText=t.filter(t=>t.active).length),document.dispatchEvent(new CustomEvent("dataTableClusterWasChanged",{bubbles:!0,cancelable:!1}))}}})}update(t){this.cluster&&(this.cluster.update(t.filter(t=>t.active).map(t=>t.markup)),this.scrollElem.scrollTop=0)}}class o{constructor(t="dataTableFilters"){this.storageKey=t}clearAll(){localStorage.removeItem(this.storageKey)}get(t){const e=localStorage.getItem(this.storageKey);return e&&JSON.parse(e)[t]||{}}set(t){localStorage.setItem(this.storageKey,JSON.stringify(t))}}class i{constructor(t){this.wrapper=t,this.table=t.querySelector("table"),this.tbody=this.table?.querySelector("tbody"),this.scrollElem=t.querySelector(".scroll-area"),this.searchInput=t.querySelector('input[type="search"]'),this.resetBtn=t.querySelector("[data-dataTable-reset]"),this.settings=JSON.parse(t.getAttribute("data-dataTable-settings")),this.storage=new o,this.filterManager=new e(t,this.storage),this.clusterRenderer=new s(t,this.tbody,this.scrollElem),this.sorter=new r(t.querySelectorAll("thead th[data-dataTable-sort]"))}async render(){this.table&&this.tbody&&this.searchInput&&(this.wrapper.querySelectorAll('input[type="date"][data-default-to-today]').forEach(t=>t.valueAsDate=new Date),fetch(this.settings.url,{cache:"no-store"}).then(async t=>{const e=await t.json();this.clusterRenderer.init(e);const a=()=>{const t=this.searchInput.value.trim(),a=this.filterManager.getActiveFilters();this.filterManager.updateDropdownState(a);const r=this.filterManager.applyFiltersToRows(e,t);this.clusterRenderer.update(r),this.resetBtn.classList.toggle("hidden",!(Object.keys(a).length>0||t.length>0))};this.filterManager.prefillFromStorage(this.settings.name),a(),this.searchInput.addEventListener("input",((t,e=300)=>{let a;return(...r)=>{clearTimeout(a),a=setTimeout(()=>{t.apply(void 0,r)},e)}})(a)),this.wrapper.querySelectorAll("[data-dataTable-filter]").forEach(t=>t.addEventListener("input",a)),this.sorter.attachListeners(e,this.clusterRenderer.cluster,this.scrollElem),this.resetBtn&&this.resetBtn.addEventListener("click",t=>{t.preventDefault(),location.reload()}),this.wrapper.querySelectorAll("[data-datatable-filter-clear]").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const r=t.getAttribute("data-datatable-filter-clear");this.wrapper.querySelectorAll(`[name^="${r}"]`).forEach(t=>{"radio"===t.type||"checkbox"===t.type?t.checked=!1:t.value=""}),a()})})}))}}class n{constructor(t,e){this.wrapper=t,this.config=e,this.placesControl=null,this.mainFeatureGroup=L.featureGroup(),this.map=L.map(this.wrapper,{scrollWheelZoom:!0,minZoom:1,maxZoom:21}),this.config.tileLayerUrls.forEach(t=>{L.tileLayer(t).addTo(this.map)})}redraw(t){t=t.filter(t=>t.active),this.mainFeatureGroup.clearLayers(),this.placesControl&&this.map.removeControl(this.placesControl);const e=[],a=new Map,r=L.featureGroup(),s=(t=>{const e=t.reduce((t,e)=>{const a=e.location.state;return a&&(t[a]=(t[a]||0)+1),t},{});return Object.keys(e).reduce((t,a)=>e[t]>e[a]?t:a,"")||null})(t);t.forEach(t=>{const{countryCode:e,state:o}=t.location;a.has(e)||a.set(e,L.featureGroup());const i=L.Polyline.fromEncoded(t.encodedPolyline).getLatLngs();L.polyline(i,{color:this.config.polylineColor,weight:1.5,opacity:.5,smoothFactor:1,overrideExisting:!0,detectColors:!0}).addTo(a.get(e)),s===o&&L.polyline(i).addTo(r)}),a.forEach((t,a)=>{t.addTo(this.mainFeatureGroup),e.push({countryCode:a,bounds:t.getBounds()})}),this.mainFeatureGroup.addTo(this.map),this.placesControl=L.control.flyToPlaces({places:e}),this.placesControl.addTo(this.map),r.getBounds().isValid()&&this.map.fitBounds(r.getBounds())}}class l{constructor(t){this.wrapper=t,this.heatmap=t.querySelector("[data-leaflet-routes]"),this.resetBtn=t.querySelector("[data-dataTable-reset]"),this.config=JSON.parse(this.heatmap.getAttribute("data-heatmap-config")),this.filterManager=new e(t,new o),this.drawer=new n(this.heatmap,this.config)}async render(){this.wrapper.querySelectorAll('input[type="date"][data-default-to-today]').forEach(t=>t.valueAsDate=new Date);const t=JSON.parse(this.heatmap.getAttribute("data-leaflet-routes")),e=()=>{const e=this.filterManager.getActiveFilters();this.filterManager.updateDropdownState(e);const a=this.filterManager.applyFiltersToRows(t);this.drawer.redraw(a),this.resetBtn.classList.toggle("hidden",!(Object.keys(e).length>0));const r=this.wrapper.querySelector("[data-dataTable-result-count]");r&&(r.innerText=a.length)};e(),this.wrapper.querySelectorAll("[data-dataTable-filter]").forEach(t=>t.addEventListener("input",e)),this.resetBtn&&this.resetBtn.addEventListener("click",t=>{t.preventDefault(),location.reload()}),this.wrapper.querySelectorAll("[data-datatable-filter-clear]").forEach(t=>{t.addEventListener("click",a=>{a.preventDefault();const r=t.getAttribute("data-datatable-filter-clear");this.wrapper.querySelectorAll(`[name^="${r}"]`).forEach(t=>{"radio"===t.type||"checkbox"===t.type?t.checked=!1:t.value=""}),e()})})}}class c{constructor(t){this.chatWrapper=t.querySelector(".chat--wrapper"),this.form=t.querySelector("form"),this.button=this.form.querySelector("button.send-message"),this.textInput=this.form.querySelector("input.message"),this.spinner=this.form.querySelector("div.spinner"),this.placeholderIdle=this.textInput.getAttribute("data-placeholder-idle"),this.placeholderProcessing=this.textInput.getAttribute("data-placeholder-processing"),this.commands=JSON.parse(this.chatWrapper.getAttribute("data-chat-commands")||"{}"),this.autoCompleteJS=null}toggleElements(t){this.textInput.disabled=t,this.button.disabled=t,this.button.classList.toggle("inline-flex",!t),this.button.classList.toggle("hidden",t),this.form.classList.toggle("disabled",t),this.spinner.classList.toggle("hidden",!t),this.textInput.value="",this.textInput.placeholder=t?this.placeholderProcessing:this.placeholderIdle}initAutoComplete(){this.commands&&0!==Object.keys(this.commands).length&&(this.autoCompleteJS=new autoComplete({selector:()=>this.textInput,data:{src:Object.keys(this.commands)},threshold:1,trigger:t=>t.startsWith("/"),resultsList:{tabSelect:!0,position:"beforebegin"},resultItem:{highlight:!0,element:(t,e)=>{t.innerHTML=`\n                        <div>${e.match}</div>\n                        <div class="text-xs text-gray-500">${this.commands[e.value]}</div>\n                    `}},events:{input:{focus:()=>{this.autoCompleteJS.input.value.length&&this.autoCompleteJS.start()}}}}),this.autoCompleteJS.input.addEventListener("selection",t=>{const e=t.detail;this.autoCompleteJS.input.value=this.commands[e.selection.value]||""}))}handleSSE(t){const e=new EventSource(`/chat/sse?message=${encodeURIComponent(t)}`);e.addEventListener("fullMessage",t=>{this.chatWrapper.innerHTML+=t.data.replace(/\\n/g,"\n")}),e.addEventListener("removeThinking",()=>{const t=this.chatWrapper.querySelector(".thinking");t?.remove()}),e.addEventListener("agentResponse",t=>{const e=this.chatWrapper.querySelector("div.message-wrapper:last-child > div.message");e&&(e.innerHTML+=t.data.replace(/\\n/g,"\n"))}),e.addEventListener("done",()=>{e.close(),this.toggleElements(!1),this.textInput.focus()})}bindEvents(){this.form.addEventListener("submit",t=>{t.preventDefault();const e=new FormData(this.form);this.toggleElements(!0),this.handleSSE(e.get("form[message]"))}),this.textInput.addEventListener("keydown",t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),this.form.requestSubmit())})}render(){this.initAutoComplete(),this.bindEvents()}}const d=document.querySelector("main"),u=document.querySelector("aside"),h=document.querySelector("nav");"true"===localStorage.getItem("sideNavCollapsed")&&(d.classList.add("sidebar-is-collapsed"),u.classList.add("sidebar-is-collapsed"),h.classList.add("sidebar-is-collapsed"));const p=()=>w.forEach(t=>t.resize());document.getElementById("toggle-sidebar-collapsed-state")?.addEventListener("click",()=>{const t=d.classList.toggle("sidebar-is-collapsed");[u,h].forEach(e=>e.classList.toggle("sidebar-is-collapsed",t)),localStorage.setItem("sideNavCollapsed",String(t)),p()});const m=new class{constructor(t){this.app=t,this.appContent=t.querySelector("#js-loaded-content"),this.spinner=t.querySelector("#spinner"),this.menu=document.querySelector("aside"),this.menuItems=document.querySelectorAll("nav a[data-router-navigate]:not([data-router-disabled]), aside li a[data-router-navigate]:not([data-router-disabled])"),this.mobileNavTriggerEl=document.querySelector('[data-drawer-target="drawer-navigation"]'),this.defaultRoute="/dashboard"}showLoader(){this.spinner.classList.remove("hidden"),this.spinner.classList.add("flex"),this.appContent.classList.add("hidden")}hideLoader(){this.spinner.classList.remove("flex"),this.spinner.classList.add("hidden"),this.appContent.classList.remove("hidden")}determineActiveMenuLink(t){const e=document.querySelector(`aside li a[data-router-navigate="${t}"]`);if(e)return e;const a=t.replace(/\/[^\/]*$/,"");return a===t||""===a?null:this.determineActiveMenuLink(a)}async renderContent(t,e){this.menu.hasAttribute("aria-hidden")||this.mobileNavTriggerEl.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),this.showLoader();const a=await fetch(`${t}.html`,{cache:"no-store"});this.appContent.innerHTML=await a.text(),window.scrollTo(0,0),this.hideLoader(),this.app.setAttribute("data-router-current",t),this.app.setAttribute("data-modal-current",e),this.menuItems.forEach(t=>t.setAttribute("aria-selected","false"));const r=this.determineActiveMenuLink(t);r?.setAttribute("aria-selected","true"),r?.hasAttribute("data-router-sub-menu")&&r.closest("ul")?.classList.remove("hidden");const s=document.querySelectorAll("main a[data-router-navigate]:not([data-router-disabled])");this.registerNavItems(s);const o=t.replace(/^\/+/,"").replaceAll("/","-");document.dispatchEvent(new CustomEvent("pageWasLoaded",{bubbles:!0,detail:{page:o,modalId:e}})),document.dispatchEvent(new CustomEvent(`pageWasLoaded.${o}`,{bubbles:!0,detail:{page:o,modalId:e}}))}registerNavItems(t){t.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const a=t.getAttribute("data-router-navigate");document.dispatchEvent(new CustomEvent("navigationLinkHasBeenClicked",{bubbles:!0,detail:{link:t}})),this.navigateTo(a,null,t.hasAttribute("data-router-force-reload"))})})}registerBrowserBackAndForth(){window.onpopstate=t=>{t.state&&this.renderContent(t.state.route,t.state.modal)}}navigateTo(t,e,a=!1){(this.app.getAttribute("data-router-current")!==t||a)&&(this.renderContent(t,e),this.pushRouteToHistoryState(t,e))}pushRouteToHistoryState(t,e){const a=e?`${t}#${e}`:t;window.history.pushState({route:t,modal:e},"",a)}pushCurrentRouteToHistoryState(t){this.pushRouteToHistoryState(this.currentRoute(),t)}currentRoute(){return location.pathname.replace("/","")?location.pathname:this.defaultRoute}boot(){if(null===this.appContent)return;const t=this.currentRoute(),e=location.hash.replace("#","");this.registerNavItems(this.menuItems),this.registerBrowserBackAndForth(),this.renderContent(t,e),window.history.replaceState({route:t,modal:e},"",t+location.hash)}}(d);m.boot();const g=new o,f=document.getElementById("modal-skeleton"),b=f.querySelector("#modal-content"),y=f.querySelector(".spinner");let v=null,S=[],w=[];document.addEventListener("pageWasLoaded",t=>{v&&v.hide(),document.querySelectorAll("div[data-dataTable-settings]").forEach(function(t){new i(t).render()}),S=[],w=[],A(document),t.detail&&t.detail.modalId&&q(t.detail.modalId)}),document.addEventListener("pageWasLoaded.heatmap",()=>{const t=document.querySelector(".heatmap-wrapper");new l(t).render()}),document.addEventListener("navigationLinkHasBeenClicked",t=>{t.detail&&t.detail.link&&t.detail.link.hasAttribute("data-dataTable-filters")&&g.set(JSON.parse(t.detail.link.getAttribute("data-dataTable-filters")))}),document.addEventListener("dataTableClusterWasChanged",()=>{T(document)}),window.addEventListener("resize",function(){p()});const E=document.querySelector("a[data-modal-custom-ai]");E&&E.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const e=E.getAttribute("data-modal-custom-ai");q(e),m.pushCurrentRouteToHistoryState(e)}),document.addEventListener("modalWasLoaded.ai-chat",t=>{const e=t.detail.modal;c(e).render()});const A=e=>{lazyLoad.update(),k(e),initPopovers(),initTooltips(),initDropdowns(),initAccordions(),T(e);const a={handleWeeklyStatsClick:(t,e)=>{if(!t||!t.dataIndex)return;const a=JSON.parse(e.getAttribute("data-echarts-click-data"));!t.dataIndex in a||(g.set({activities:{"start-date.from":a[t.dataIndex].from,"start-date.to":a[t.dataIndex].to}}),m.navigateTo("/activities"))},handleActivityGridChartClick:(t,e)=>{!t||!t.value||t.value<1||(g.set({activities:{"start-date.from":t.value[0],"start-date.to":t.value[0]}}),m.navigateTo("/activities"))}},r=[];e.querySelectorAll("[data-echarts-options]").forEach(function(e){const s=echarts.init(e),o=JSON.parse(e.getAttribute("data-echarts-options"));t(o,"tooltip.formatter"),t(o,"tooltip.valueFormatter"),t(o,"yAxis.axisLabel.formatter"),t(o,"yAxis[].axisLabel.formatter"),t(o,"series.symbolSize"),s.setOption(o);const i=e.getAttribute("data-echarts-click");i&&a[i]&&s.on("click",function(t){a[i](t,e)}),e.hasAttribute("data-echarts-connect")&&r.push(s),w.push(s);const n=e.closest('div[role="tabpanel"]');if(n){const t=n.getAttribute("id");S[t]=S[t]||[],S[t].push(s)}}),echarts.connect(r),e.querySelectorAll("[data-leaflet]").forEach(function(t){const e=JSON.parse(t.getAttribute("data-leaflet"));(function(t,e){return{render:()=>{const a=L.map(t,{scrollWheelZoom:!1,minZoom:e.minZoom,maxZoom:e.maxZoom});e.tileLayer&&L.tileLayer(e.tileLayer).addTo(a);const r=L.featureGroup();if(e.routes.forEach(t=>{L.polyline(L.Polyline.fromEncoded(t).getLatLngs(),{color:"#fc6719",weight:2,opacity:.9,lineJoin:"round"}).addTo(r)}),e.imageOverlay&&(L.imageOverlay(e.imageOverlay,e.bounds,{attribution:'Â© <a href="https://zwift.com" rel="noreferrer noopener">Zwift</a>'}).addTo(a),a.setMaxBounds(e.bounds)),r.addTo(a),a.fitBounds(r.getBounds(),{maxZoom:e.maxZoom}),!t.hasAttribute("data-leaflet-echart-connect"))return;const s=document.querySelector("div[data-echarts-options][data-leaflet-echart-connect]");if(!s)return;const o=JSON.parse(s.getAttribute("data-leaflet-echart-connect"));if(!o)return;const i=L.circleMarker([0,0],{radius:6,color:"#303030",fillColor:"#F26722",fillOpacity:0,opacity:0}).addTo(a),n=echarts.getInstanceByDom(s),l=a.getZoom();n.on("updateAxisPointer",function(t){t.dataIndex&&t.dataIndex in o?(i.setLatLng(o[t.dataIndex]),i.setStyle({opacity:1,fillOpacity:1}),a.getZoom()>l&&a.panTo(i.getLatLng())):i.setStyle({opacity:0,fillOpacity:0})})}}})(t,e).render()}),e.querySelectorAll("[data-light-gallery-elements]").forEach(function(t){const e=JSON.parse(t.getAttribute("data-light-gallery-elements")),a=lightGallery(t,{dynamic:!0,plugins:[lgZoom],backdropDuration:200,dynamicEl:e});t.addEventListener("click",()=>{a.openGallery()})})},T=t=>{t.querySelectorAll("a[data-model-content-url]").forEach(function(t){t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();const a=t.getAttribute("data-model-content-url");q(a),m.pushCurrentRouteToHistoryState(a)})})},k=t=>{t.querySelectorAll("[data-tabs]").forEach(t=>{const e=[];let a=null;t.querySelectorAll('[role="tab"]').forEach(function(t){const r=t.getAttribute("data-tabs-target");e.push({id:r,triggerEl:t,targetEl:document.querySelector(r)}),t.hasAttribute("data-tab-default")&&(a=r)}),new Tabs(t,e,{defaultTabId:a,activeClasses:"text-strava-orange border-strava-orange hover:text-gray-600 hover:border-gray-300",inactiveClasses:"text-gray-500 hover:text-gray-600 border-gray-100 hover:border-gray-300",onShow:(t,e)=>{const a=e.id.replace("#","");a in S&&S[a].forEach(t=>t.resize())}})})},q=t=>{v&&v.hide(),y.classList.remove("hidden"),y.classList.add("flex"),v=new Modal(f,{placement:"bottom",closable:!0,backdropClasses:"bg-gray-900/50 fixed inset-0 z-1400",onShow:async()=>{const e=await fetch(t,{cache:"no-store"});y.classList.add("hidden"),y.classList.remove("flex"),b.innerHTML=await e.text(),A(f),b.querySelector("button.close")&&b.querySelector("button.close").addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),v.hide(),m.pushCurrentRouteToHistoryState()}),document.body.addEventListener("keydown",t=>{"Escape"===t.key&&m.pushCurrentRouteToHistoryState()},{once:!0}),document.body.addEventListener("click",t=>{"modal-skeleton"===t.target.id&&m.pushCurrentRouteToHistoryState()},{once:!0});const a=f.querySelectorAll("a[data-router-navigate]:not([data-router-disabled])");m.registerNavItems(a);const r=t.replace(/^\/+/,"").replaceAll("/","-");document.dispatchEvent(new CustomEvent("modalWasLoaded."+r,{bubbles:!0,cancelable:!1,detail:{modal:f}}))},onHide:()=>{b.innerHTML=""}}),v.show()},C=t=>{const e=document.querySelector("[data-latest-version]"),a=e.querySelector("a");a&&(a.href=a.href.replace("[LATEST_VERSION]",t),a.textContent=a.textContent.replace("[LATEST_VERSION]",t)),e.classList.remove("hidden")};(async()=>{await(async()=>{const t=document.querySelector("[data-latest-version]");if(!t)return;const e=t.dataset.currentVersion;if(!e)return;const a="latestReleaseCache",r=Date.now(),s=JSON.parse(localStorage.getItem(a)||"null");if(s&&r-s.timestamp<216e5)((t,e)=>{t=t.replace(/^v/,""),e=e.replace(/^v/,"");const a=t.split(".").map(Number),r=e.split(".").map(Number);for(let t=0;t<Math.max(a.length,r.length);t++){const e=a[t]||0,s=r[t]||0;if(e>s)return 1;if(e<s)return-1}return 0})(e,s.latestVersion)<0&&C(s.latestVersion);else try{const t=await fetch("https://api.github.com/repos/robiningelbrecht/statistics-for-strava/releases/latest",{headers:{Accept:"application/vnd.github+json"}});if(!t.ok)throw new Error("Failed to fetch latest release");const s=(await t.json()).name;if(e===s)return void localStorage.setItem(a,JSON.stringify({latestVersion:s,timestamp:r}));const o=await fetch(`https://api.github.com/repos/robiningelbrecht/statistics-for-strava/actions/runs?event=push&status=completed&conclusion=success&exclude_pull_requests=true&branch=${s}`,{headers:{Accept:"application/vnd.github+json"}});if(!o.ok)throw new Error("Failed to fetch workflow runs");const{workflow_runs:i=[]}=await o.json();if(!i.find(t=>".github/workflows/docker-image.yml"===t.path))return;C(s),localStorage.setItem(a,JSON.stringify({latestVersion:s,timestamp:r}))}catch(t){console.error("Error checking latest release:",t)}})()})()})();